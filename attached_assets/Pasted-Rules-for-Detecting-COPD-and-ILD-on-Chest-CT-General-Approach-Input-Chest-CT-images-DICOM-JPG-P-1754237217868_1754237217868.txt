Rules for Detecting COPD and ILD on Chest CT
General Approach

Input: Chest CT images (DICOM, JPG, PNG, or zipped DICOM slices) in lung window (window width: 1000–1500 HU, window level: -600 to -700 HU).
Analysis: The AI evaluates imaging features such as lung parenchymal changes, airway abnormalities, and associated findings, correlating them with clinical history (e.g., smoking history, dyspnea, cough).
Output: A radiological report detailing findings, specific COPD/ILD subtype identification, and two differential diagnoses, integrated with patient information (Name, ID, Gender, DOB, Exam Date, Clinical History).
Caveat: AI interpretations are for educational purposes and must be validated by a radiologist.


Rules for Detecting COPD
COPD encompasses Emphysema and Chronic Bronchitis, characterized by airflow obstruction. The rules focus on CT findings specific to each subtype.
1. Emphysema
Emphysema involves permanent alveolar destruction leading to air trapping. Subtypes include centrilobular, panlobular, and paraseptal emphysema.
Detection Rules:

Centrilobular Emphysema:

Primary Criterion: Presence of focal areas of low attenuation (<-950 HU on inspiratory CT) in the central portion of secondary pulmonary lobules, predominantly in upper lobes.
Secondary Criteria:

Destruction of alveolar walls without fibrosis.
Sparing of distal lobules near pleura and fissures.
Associated with smoking history (clinical history correlation: >10 pack-years).


Quantitative Threshold: >10% of lung volume with low-attenuation areas (LAA) on CT.


Panlobular Emphysema:

Primary Criterion: Diffuse low-attenuation areas (<-950 HU) affecting entire secondary pulmonary lobules, often in lower lobes.
Secondary Criteria:

Uniform destruction of alveolar architecture.
Associated with alpha-1 antitrypsin deficiency (check clinical history).
Reduced vascular markings throughout affected lobes.


Quantitative Threshold: >15% of lung volume with LAA, often more extensive than centrilobular.


Paraseptal Emphysema:

Primary Criterion: Subpleural and perivascular low-attenuation areas, often along pleural surfaces or fissures.
Secondary Criteria:

Presence of bullae (air spaces >1 cm) adjacent to pleura.
Minimal central lobular involvement.
Risk of pneumothorax (check for pleural air pockets).


Quantitative Threshold: Subpleural LAA in >5% of lung volume, typically upper lobe predominant.



Additional Findings:

Air trapping on expiratory CT (mosaic attenuation pattern).
Flattening of the diaphragm or increased anteroposterior chest diameter (barrel chest).
Saber-sheath trachea (coronal narrowing of trachea).

Report Inclusion:

Specify subtype (centrilobular, panlobular, paraseptal).
Quantify extent of low-attenuation areas (% lung volume).
Note associated features (e.g., bullae, air trapping).
Differential diagnoses: ILD (e.g., early fibrosis mimicking emphysema), bronchiectasis, or cystic lung diseases.

2. Chronic Bronchitis
Chronic Bronchitis involves airway inflammation and mucus hypersecretion, often without parenchymal destruction.
Detection Rules:

Primary Criterion: Bronchial wall thickening (>1.5 mm wall thickness) in segmental or subsegmental bronchi.
Secondary Criteria:

Mucus plugging in airways (tree-in-bud or linear filling defects).
Bronchial dilatation relative to adjacent pulmonary artery (signet ring sign).
Mosaic attenuation on inspiratory CT due to small airway obstruction.
Clinical history correlation: chronic cough with sputum production (>3 months/year for 2 years).


Quantitative Threshold: Bronchial wall thickening in >20% of visible airways on CT.

Additional Findings:

Centrilobular nodules or ground-glass opacities due to inflammation.
Air trapping on expiratory CT (similar to emphysema but airway-centric).

Report Inclusion:

Describe airway changes (wall thickening, mucus plugging).
Note extent of airway involvement (% of bronchi affected).
Differential diagnoses: Asthma, bronchiectasis, or early ILD with airway involvement.

COPD Combined Report:

If both emphysema and chronic bronchitis features are present, classify as “mixed COPD” with specific mention of dominant subtype.
Correlate with clinical history (e.g., smoking, occupational exposures).
Example: “Centrilobular emphysema with 15% low-attenuation areas in upper lobes, combined with bronchial wall thickening in 25% of segmental bronchi, consistent with mixed COPD.”


Rules for Detecting ILD
ILD encompasses a group of disorders causing lung parenchymal inflammation and/or fibrosis. Key subtypes include Usual Interstitial Pneumonia (UIP), Non-Specific Interstitial Pneumonia (NSIP), and Cryptogenic Organizing Pneumonia (COP).
1. Usual Interstitial Pneumonia (UIP)
UIP is the radiological pattern of idiopathic pulmonary fibrosis (IPF) and some connective tissue disease-related ILDs.
Detection Rules:

Primary Criterion: Subpleural, basal-predominant reticular opacities with honeycombing (clustered cystic air spaces 3–10 mm, typically in lower lobes).
Secondary Criteria:

Traction bronchiectasis (irregular bronchial dilatation due to fibrosis).
Minimal or absent ground-glass opacities (<10% of affected areas).
Absence of features inconsistent with UIP (e.g., extensive ground-glass, nodules, consolidation).


Quantitative Threshold: Honeycombing in >5% of lower lobe volume, reticular opacities in >20% of lung volume.
Clinical Correlation: Progressive dyspnea, dry cough, age >50 years, or connective tissue disease history.

Additional Findings:

Peripheral and posterior predominance.
Mediastinal lymphadenopathy (mild, <1.5 cm nodes).
Esophageal dilatation (common in systemic sclerosis-related UIP).

Report Inclusion:

Specify “UIP pattern” and note honeycombing extent.
Differential diagnoses: NSIP, chronic hypersensitivity pneumonitis, or sarcoidosis.

2. Non-Specific Interstitial Pneumonia (NSIP)
NSIP is associated with connective tissue diseases or idiopathic causes, with a more uniform pattern than UIP.
Detection Rules:

Primary Criterion: Bilateral, symmetrical ground-glass opacities, predominantly in lower lobes.
Secondary Criteria:

Fine reticular opacities without honeycombing.
Traction bronchiectasis in areas of ground-glass.
Sparing of subpleural regions (unlike UIP).


Quantitative Threshold: Ground-glass opacities in >30% of lung volume, reticular opacities in <10%.
Clinical Correlation: Connective tissue disease (e.g., scleroderma, rheumatoid arthritis), younger age (<50 years).

Additional Findings:

Microcystic changes (smaller than UIP honeycombing).
Peribronchovascular distribution in some cases.

Report Inclusion:

Specify “NSIP pattern” and quantify ground-glass extent.
Differential diagnoses: UIP, hypersensitivity pneumonitis, or early COP.

3. Cryptogenic Organizing Pneumonia (COP)
COP is characterized by organizing pneumonia, often post-infectious or idiopathic.
Detection Rules:

Primary Criterion: Patchy consolidation or ground-glass opacities in a peribronchovascular or peripheral distribution (tree-in-bud or reversed halo sign).
Secondary Criteria:

Atoll sign (ring-shaped consolidation with central ground-glass).
Migratory opacities if serial imaging is available.
Absence of honeycombing or extensive reticulation.


Quantitative Threshold: Consolidation/ground-glass in >20% of lung volume, often multifocal.
Clinical Correlation: Subacute onset of cough, fever, or flu-like symptoms.

Additional Findings:

Centrilobular nodules or tree-in-bud patterns.
Mild bronchial wall thickening.

Report Inclusion:

Specify “COP pattern” and describe atoll sign if present.
Differential diagnoses: Pneumonia (infectious), NSIP, or pulmonary vasculitis.

Other ILD Subtypes:

Hypersensitivity Pneumonitis (HP):

Rules: Centrilobular ground-glass nodules, mosaic attenuation, air trapping on expiratory CT, upper lobe predominance (chronic HP may mimic UIP).
Clinical Correlation: Exposure to antigens (e.g., birds, mold).
Differential: NSIP, sarcoidosis.


Sarcoidosis:

Rules: Bilateral hilar lymphadenopathy, perilymphatic nodules, upper lobe fibrosis in chronic cases.
Clinical Correlation: Systemic symptoms, erythema nodosum.
Differential: Lymphoma, tuberculosis.



ILD Combined Report:

Classify as UIP, NSIP, COP, or other based on dominant pattern.
Quantify extent of key findings (e.g., % ground-glass, honeycombing).
Note distribution (subpleural, peribronchovascular, basal).
Example: “Subpleural basal honeycombing (8% of lower lobes) with reticular opacities, consistent with UIP pattern, likely IPF given clinical history of progressive dyspnea.”


Integration into Radiological and Clinical Report
Report Structure:

Patient Information:

Name, ID, Gender, DOB, Examination Date.


Clinical History & Symptoms:

Summarize provided history (e.g., “60-year-old male, 30 pack-year smoker, presents with chronic cough and dyspnea”).


Radiological Findings:

Describe CT findings (e.g., “Bilateral upper lobe centrilobular low-attenuation areas [15% lung volume], bronchial wall thickening in 25% of airways” for COPD; “Subpleural basal honeycombing [7% lower lobes], reticular opacities” for UIP).
Specify distribution, extent, and associated features (e.g., traction bronchiectasis, bullae).


Diagnosis:

Primary diagnosis: “COPD (centrilobular emphysema)” or “ILD (UIP pattern, suggestive of IPF).”
Subtype classification: Specify emphysema type or ILD pattern.
Two differential diagnoses (e.g., for UIP: chronic HP, NSIP; for COPD: bronchiectasis, asthma).


Clinical Correlation:

Link findings to clinical history (e.g., smoking for COPD, connective tissue disease for NSIP).
Recommend spirometry for COPD (FEV1/FVC <0.7) or multidisciplinary discussion for ILD.


Disclaimer: “This AI-generated report is for educational purposes and must be reviewed by a qualified radiologist.”

Rules for AI Analysis:

COPD Detection:

If low-attenuation areas (<-950 HU) >10% and/or bronchial wall thickening >20%, flag as COPD.
Subtype based on distribution (centrilobular vs. panlobular) and airway involvement (chronic bronchitis).


ILD Detection:

If reticular opacities, ground-glass, or consolidation >10%, flag as ILD.
Subtype based on pattern: honeycombing (UIP), symmetrical ground-glass (NSIP), atoll sign (COP).


Severity Scoring:

Mild: <15% lung involvement.
Moderate: 15–30% involvement.
Severe: >30% involvement.


Error Handling:

If image quality is poor (e.g., motion artifacts), report “Suboptimal study, recommend repeat CT.”
If no COPD/ILD features, state “No definitive evidence of COPD or ILD; consider alternative diagnoses (e.g., pneumonia, cardiac failure).”




Implementation Notes for the Web App

OpenAI API Prompt: Modify the generate_openai_report function in the Replit app to include specific instructions:
text